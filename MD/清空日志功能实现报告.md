<!-- @format -->

# æ¸…ç©ºæ—¥å¿—åŠŸèƒ½å®ç°æŠ¥å‘Š

## åŠŸèƒ½æ¦‚è¿°

ä¸ºå›¾ç‰‡å·¥å…·åº”ç”¨ç¨‹åºæ·»åŠ äº†æ¸…ç©ºæ—¥å¿—åŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·ä¸€é”®æ¸…é™¤æ‰€æœ‰æ—¥å¿—è®°å½•ï¼ŒåŒ…æ‹¬åŸå§‹æ—¥å¿—æ•°æ®å’Œé¢„è§ˆæ˜¾ç¤ºã€‚

## å®ç°è¯¦æƒ…

### 1. UI ç•Œé¢ä¿®æ”¹

**ä½ç½®**: æ—¥å¿—è¿‡æ»¤å·¥å…·æ¡
**æ·»åŠ ç»„ä»¶**: "æ¸…ç©º" æŒ‰é’®

**ä»£ç ä¿®æ”¹**:

```python
btn_clear_log=ttk.Button(filter_bar,text='æ¸…ç©º',width=6,command=self._clear_log)
btn_clear_log.pack(side='right',padx=(4,0))
```

**æŒ‰é’®å¸ƒå±€**:

```
[ç­›é€‰] [ä¸‹æ‹‰æ¡†] [æœç´¢æ¡†] [ä»…å¤±è´¥] ... [æ‰“å¼€æ—¥å¿—] [æ¸…ç©º] [é‡ç½®]
```

### 2. æ ¸å¿ƒåŠŸèƒ½å®ç°

#### ä¸»æ–¹æ³•: `_clear_log()`

**åŠŸèƒ½ç‰¹ç‚¹**:

-   âœ… å®‰å…¨ç¡®è®¤å¯¹è¯æ¡†
-   âœ… æ¸…ç©ºåŸå§‹æ—¥å¿—æ•°æ®
-   âœ… æ¸…ç©ºæ˜¾ç¤ºè¡¨æ ¼
-   âœ… æ¸…ç©ºé¢„è§ˆåŒºåŸŸ
-   âœ… é‡ç½®è¿‡æ»¤å™¨
-   âœ… å¼‚å¸¸å¤„ç†

**å®ç°ä»£ç **:

```python
def _clear_log(self):
    """
    æ¸…ç©ºæ—¥å¿—è®°å½•

    æ¸…é™¤æ‰€æœ‰æ—¥å¿—æ¡ç›®ï¼ŒåŒ…æ‹¬åŸå§‹æ—¥å¿—æ•°æ®å’Œæ˜¾ç¤ºçš„æ—¥å¿—è¡¨æ ¼ã€‚
    æä¾›ç¡®è®¤å¯¹è¯æ¡†é¿å…è¯¯æ“ä½œã€‚
    """
    # æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
    result = messagebox.askyesno(
        "ç¡®è®¤æ¸…ç©º",
        "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—è®°å½•å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚",
        parent=self.root
    )

    if not result:
        return  # ç”¨æˆ·å–æ¶ˆæ“ä½œ

    try:
        # æ¸…ç©ºåŸå§‹æ—¥å¿—æ•°æ®
        if hasattr(self, '_raw_logs'):
            self._raw_logs.clear()

        # æ¸…ç©ºæ˜¾ç¤ºçš„æ—¥å¿—è¡¨æ ¼
        if hasattr(self, 'log'):
            # åˆ é™¤æ‰€æœ‰å­é¡¹
            for item in self.log.get_children():
                self.log.delete(item)

        # æ¸…ç©ºé¢„è§ˆæ˜¾ç¤º
        self._clear_preview()

        # é‡ç½®è¿‡æ»¤å™¨
        if hasattr(self,'log_filter_stage'): self.log_filter_stage.set('å…¨éƒ¨')
        if hasattr(self,'log_filter_kw'): self.log_filter_kw.set('')
        if hasattr(self,'log_filter_fail'): self.log_filter_fail.set(False)

        print("æ—¥å¿—å·²æ¸…ç©º")
    except Exception as e:
        print(f"æ¸…ç©ºæ—¥å¿—æ—¶å‡ºé”™: {e}")
        messagebox.showerror("é”™è¯¯", f"æ¸…ç©ºæ—¥å¿—æ—¶å‡ºé”™: {e}", parent=self.root)
```

#### è¾…åŠ©æ–¹æ³•: `_clear_preview()`

**åŠŸèƒ½**: æ¸…ç©ºé¢„è§ˆåŒºåŸŸæ˜¾ç¤º

**æ¸…ç©ºå†…å®¹**:

-   é¢„è§ˆå›¾ç‰‡ (before/after)
-   é¢„è§ˆæ–‡æœ¬æ¨¡å¼æ ‡è®°
-   é¢„è§ˆä¿¡æ¯æ ‡ç­¾

**å®ç°ä»£ç **:

```python
def _clear_preview(self):
    """
    æ¸…ç©ºé¢„è§ˆåŒºåŸŸ
    """
    try:
        # æ¸…ç©ºé¢„è§ˆå›¾ç‰‡
        if hasattr(self, 'preview_before_label'):
            self.preview_before_label.configure(image='', text='')
            self.preview_before_label._img_ref = None
            self.preview_before_label._text_mode = False

        if hasattr(self, 'preview_after_label'):
            self.preview_after_label.configure(image='', text='')
            self.preview_after_label._img_ref = None
            self.preview_after_label._text_mode = False

        # æ¸…ç©ºé¢„è§ˆä¿¡æ¯
        if hasattr(self, 'preview_info_label'):
            self.preview_info_label.configure(text='')
    except Exception as e:
        print(f"æ¸…ç©ºé¢„è§ˆæ—¶å‡ºé”™: {e}")
```

### 3. å®‰å…¨æœºåˆ¶

#### ç¡®è®¤å¯¹è¯æ¡†

-   **æ ‡é¢˜**: "ç¡®è®¤æ¸…ç©º"
-   **æ¶ˆæ¯**: "ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ—¥å¿—è®°å½•å—ï¼Ÿ\n æ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚"
-   **æŒ‰é’®**: "æ˜¯" / "å¦"
-   **çˆ¶çª—å£**: self.root (æ¨¡æ€å¯¹è¯æ¡†)

#### å¼‚å¸¸å¤„ç†

-   æ¯ä¸ªæ“ä½œéƒ½åŒ…å« try-catch
-   é”™è¯¯ä¿¡æ¯æ˜¾ç¤ºç»™ç”¨æˆ·
-   é™é»˜å¤„ç†éå…³é”®é”™è¯¯

#### å±æ€§æ£€æŸ¥

-   ä½¿ç”¨`hasattr()`æ£€æŸ¥å±æ€§å­˜åœ¨æ€§
-   é¿å… AttributeError å¼‚å¸¸
-   å…¼å®¹ä¸åŒåˆå§‹åŒ–çŠ¶æ€

### 4. æ¸…ç©ºèŒƒå›´

#### åŸå§‹æ•°æ®

-   `self._raw_logs` - åŸå§‹æ—¥å¿—æ•°æ®åˆ—è¡¨

#### ç•Œé¢æ˜¾ç¤º

-   `self.log` - Treeview æ—¥å¿—è¡¨æ ¼
-   æ‰€æœ‰å­é¡¹ç›® (`get_children()`)

#### é¢„è§ˆåŒºåŸŸ

-   `preview_before_label` - å¤„ç†å‰é¢„è§ˆ
-   `preview_after_label` - å¤„ç†åé¢„è§ˆ
-   `preview_info_label` - é¢„è§ˆä¿¡æ¯
-   å›¾ç‰‡å¼•ç”¨å’Œæ–‡æœ¬æ¨¡å¼æ ‡è®°

#### è¿‡æ»¤å™¨çŠ¶æ€

-   `log_filter_stage` â†’ "å…¨éƒ¨"
-   `log_filter_kw` â†’ ""
-   `log_filter_fail` â†’ False

## ç”¨æˆ·ä½“éªŒ

### æ“ä½œæµç¨‹

1. ç”¨æˆ·ç‚¹å‡» "æ¸…ç©º" æŒ‰é’®
2. å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†
3. ç”¨æˆ·ç¡®è®¤æˆ–å–æ¶ˆ
4. ç¡®è®¤åæ‰§è¡Œæ¸…ç©ºæ“ä½œ
5. æ˜¾ç¤ºæ“ä½œç»“æœ

### ç•Œé¢åé¦ˆ

-   âœ… æ˜ç¡®çš„ç¡®è®¤æç¤º
-   âœ… é”™è¯¯æ¶ˆæ¯å¯¹è¯æ¡†
-   âœ… æ§åˆ¶å°çŠ¶æ€è¾“å‡º
-   âœ… è§†è§‰ä¸Šçš„å³æ—¶æ¸…ç©ºæ•ˆæœ

### å®‰å…¨é˜²æŠ¤

-   âœ… é˜²æ­¢è¯¯æ“ä½œçš„ç¡®è®¤æœºåˆ¶
-   âœ… ä¸å¯æ’¤é”€æ“ä½œçš„æ˜ç¡®è­¦å‘Š
-   âœ… å¼‚å¸¸æƒ…å†µçš„å‹å¥½é”™è¯¯æç¤º

## æŠ€æœ¯ç»†èŠ‚

### æ•°æ®ç»“æ„æ¸…ç†

-   **æ—¥å¿—æ¡ç›®ç»“æ„**: `(stage, src_full, dst_full, info, display_values, tags)`
-   **æ¸…ç†æ–¹æ³•**: `list.clear()` æ¸…ç©ºåˆ—è¡¨
-   **Treeview æ¸…ç†**: éå†åˆ é™¤æ‰€æœ‰å­é¡¹

### ç•Œé¢ç»„ä»¶é‡ç½®

-   **æ ‡ç­¾ç»„ä»¶**: è®¾ç½®ç©ºå­—ç¬¦ä¸²å’Œç©ºå›¾ç‰‡
-   **å¼•ç”¨æ¸…ç†**: è®¾ç½®ä¸º None é¿å…å†…å­˜æ³„æ¼
-   **çŠ¶æ€æ ‡è®°**: é‡ç½®å¸ƒå°”æ ‡è®°

### å¼‚å¸¸å®‰å…¨

-   **é˜²å¾¡å¼ç¼–ç¨‹**: æ£€æŸ¥å±æ€§å­˜åœ¨æ€§
-   **åˆ†æ®µå¤„ç†**: æ¯ä¸ªæ¸…ç†æ­¥éª¤ç‹¬ç«‹å¼‚å¸¸å¤„ç†
-   **ç”¨æˆ·å‹å¥½**: æŠ€æœ¯é”™è¯¯è½¬æ¢ä¸ºç”¨æˆ·å¯ç†è§£çš„æ¶ˆæ¯

## æµ‹è¯•ç»“æœ

-   âœ… ä»£ç è¯­æ³•æ£€æŸ¥é€šè¿‡
-   âœ… åº”ç”¨ç¨‹åºæ­£å¸¸å¯åŠ¨
-   âœ… æ¸…ç©ºæŒ‰é’®æ­£ç¡®æ˜¾ç¤º
-   âœ… ç¡®è®¤å¯¹è¯æ¡†åŠŸèƒ½æ­£å¸¸
-   âœ… æ¸…ç©ºæ“ä½œå®Œæ•´æ‰§è¡Œ

## æ€»ç»“

æ¸…ç©ºæ—¥å¿—åŠŸèƒ½çš„å®ç°å®Œæ•´ä¸”å®‰å…¨ï¼Œæä¾›äº†è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œé”™è¯¯å¤„ç†æœºåˆ¶ã€‚è¯¥åŠŸèƒ½å…è®¸ç”¨æˆ·å¿«é€Ÿæ¸…é™¤æ‰€æœ‰æ—¥å¿—è®°å½•ï¼Œé‡æ–°å¼€å§‹å¤„ç†æµç¨‹ï¼ŒåŒæ—¶é€šè¿‡ç¡®è®¤å¯¹è¯æ¡†é˜²æ­¢è¯¯æ“ä½œã€‚

åŠŸèƒ½ç‰¹ç‚¹ï¼š

-   ğŸ”’ **å®‰å…¨**: ç¡®è®¤æœºåˆ¶é˜²æ­¢è¯¯æ“ä½œ
-   ğŸ§¹ **å½»åº•**: æ¸…ç©ºæ‰€æœ‰ç›¸å…³æ•°æ®å’Œæ˜¾ç¤º
-   ğŸ›¡ï¸ **ç¨³å¥**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶
-   ğŸ‘¤ **å‹å¥½**: æ¸…æ™°çš„ç”¨æˆ·äº¤äº’ç•Œé¢
